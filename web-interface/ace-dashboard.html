<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ValgACE Control Panel</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="ace-dashboard.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="ace-dashboard-config.js"></script>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Header -->
            <header class="header">
                <h1>{{ t('header.title') }}</h1>
                <div class="header-actions">
                    <button class="btn btn-language" @click="toggleLanguage">
                        {{ currentLanguage === 'en' ? 'RU' : 'EN' }}
                    </button>
                    <div class="connection-status" :class="{ connected: wsConnected, disconnected: !wsConnected }">
                        <span class="status-dot"></span>
                        <span>{{ wsConnected ? t('header.connected') : t('header.disconnected') }}</span>
                    </div>
                </div>
            </header>

            <!-- Device Status Card -->
            <div class="card device-status-card">
                <h2>{{ t('cards.deviceStatus') }}</h2>
                <div class="device-info">
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.model') }}:</span>
                        <span class="value">{{ deviceStatus.model || t('common.unknown') }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.firmware') }}:</span>
                        <span class="value">{{ deviceStatus.firmware || t('common.unknown') }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.status') }}:</span>
                        <span class="value status-badge" :class="deviceStatus.status">
                            {{ getStatusText(deviceStatus.status) }}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.temp') }}:</span>
                        <span class="value">{{ deviceStatus.temp || 0 }}°C</span>
                    </div>
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.fan') }}:</span>
                        <span class="value">{{ deviceStatus.fan_speed || 0 }} RPM</span>
                    </div>
                    <div class="info-row">
                        <span class="label">{{ t('deviceInfo.rfid') }}:</span>
                        <span class="value">{{ deviceStatus.enable_rfid ? t('deviceInfo.rfidOn') : t('deviceInfo.rfidOff') }}</span>
                    </div>
                </div>
            </div>

            <!-- Dryer Control Card -->
            <div class="card dryer-card">
                <h2>{{ t('cards.dryer') }}</h2>
                <div class="dryer-status">
                    <div class="dryer-info">
                        <div class="info-row">
                            <span class="label">{{ t('dryer.status') }}:</span>
                            <span class="value status-badge" :class="dryerStatus.status">
                                {{ getDryerStatusText(dryerStatus.status) }}
                            </span>
                        </div>
                        <div class="info-row" v-if="dryerStatus.status === 'drying'">
                            <span class="label">{{ t('dryer.targetTemp') }}:</span>
                            <span class="value">{{ dryerStatus.target_temp }}°C</span>
                        </div>
                        <div class="info-row" v-if="dryerStatus.status === 'drying'">
                            <span class="label">{{ t('dryer.duration') }}:</span>
                            <span class="value">{{ formatTime(dryerStatus.duration) }}</span>
                        </div>
                        <div class="info-row" v-if="dryerStatus.status === 'drying'">
                            <span class="label">{{ t('dryer.remainingTime') }}:</span>
                            <span class="value">{{ formatRemainingTime(dryerStatus.remain_time) }}</span>
                        </div>
                    </div>
                    <div class="dryer-controls">
                        <div class="control-group">
                            <label>{{ t('dryer.inputs.temp') }}</label>
                            <input type="number" v-model.number="dryingTemp" min="20" max="55" :disabled="dryerStatus.status === 'drying'">
                        </div>
                        <div class="control-group">
                            <label>{{ t('dryer.inputs.duration') }}</label>
                            <input type="number" v-model.number="dryingDuration" min="1" max="1440" :disabled="dryerStatus.status === 'drying'">
                        </div>
                        <div class="button-group">
                            <button @click="startDrying" :disabled="dryerStatus.status === 'drying'" class="btn btn-primary">
                                {{ t('dryer.buttons.start') }}
                            </button>
                            <button @click="stopDrying" :disabled="dryerStatus.status === 'stop'" class="btn btn-danger">
                                {{ t('dryer.buttons.stop') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slots Grid -->
            <div class="card slots-card">
                <h2>{{ t('cards.slots') }}</h2>
                <div class="slots-grid">
                    <div 
                        v-for="slot in slots" 
                        :key="slot.index"
                        class="slot-card"
                        :class="{ 
                            ready: slot.status === 'ready',
                            empty: slot.status === 'empty',
                            busy: slot.status === 'busy',
                            active: currentTool === slot.index
                        }"
                    >
                        <div class="slot-header">
                            <h3>{{ t('slots.slot') }} {{ slot.index }}</h3>
                            <span class="slot-status-badge" :class="slot.status">
                                {{ getSlotStatusText(slot.status) }}
                            </span>
                        </div>
                        
                        <div class="slot-color" :style="{ backgroundColor: getColorHex(slot.color) }">
                            <span class="color-label">{{ getColorHex(slot.color) }}</span>
                        </div>
                        
                        <div class="slot-info">
                            <div class="info-item">
                                <span class="label">{{ t('slots.type') }}:</span>
                                <span class="value">{{ slot.type || t('common.unknown') }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">{{ t('slots.sku') }}:</span>
                                <span class="value">{{ slot.sku || t('common.unknown') }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">{{ t('slots.rfid') }}:</span>
                                <span class="value">{{ getRfidStatusText(slot.rfid) }}</span>
                            </div>
                        </div>
                        
                        <div class="slot-actions">
                            <button 
                                @click="changeTool(slot.index)" 
                                :disabled="slot.status !== 'ready' || currentTool === slot.index"
                                class="btn btn-sm btn-primary"
                            >
                                {{ t('buttons.load') }}
                            </button>
                            <button 
                                @click="parkToToolhead(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-secondary"
                            >
                                {{ t('buttons.park') }}
                            </button>
                            <button 
                                @click="toggleFeedAssist(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm"
                                :class="feedAssistSlot === slot.index ? 'btn-success' : 'btn-outline-success'"
                            >
                                {{ feedAssistSlot === slot.index ? t('buttons.assistOn') : t('buttons.assistOff') }}
                            </button>
                            <button 
                                @click="showFeedDialog(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-info"
                            >
                                {{ t('buttons.feed') }}
                            </button>
                            <button 
                                @click="showRetractDialog(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-warning"
                            >
                                {{ t('buttons.retract') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card quick-actions-card">
                <h2>{{ t('cards.quickActions') }}</h2>
                <div class="quick-actions">
                    <button @click="unloadFilament" class="btn btn-danger">
                        {{ t('quickActions.unload') }}
                    </button>
                    <button @click="stopAssist" class="btn btn-warning">
                        {{ t('quickActions.stopAssist') }}
                    </button>
                    <button @click="refreshStatus" class="btn btn-secondary">
                        {{ t('quickActions.refresh') }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Feed Dialog -->
        <div v-if="showFeedModal" class="modal-overlay" @click="closeFeedDialog">
            <div class="modal" @click.stop>
                <h3>{{ t('dialogs.feedTitle', { slot: feedSlot }) }}</h3>
                <div class="form-group">
                    <label>{{ t('dialogs.length') }}</label>
                    <input type="number" v-model.number="feedLength" min="1" max="2000">
                </div>
                <div class="form-group">
                    <label>{{ t('dialogs.speed') }}</label>
                    <input type="number" v-model.number="feedSpeed" min="1" max="100">
                </div>
                <div class="modal-actions">
                    <button @click="executeFeed" class="btn btn-primary">{{ t('dialogs.execute') }}</button>
                    <button @click="closeFeedDialog" class="btn btn-secondary">{{ t('dialogs.cancel') }}</button>
                </div>
            </div>
        </div>

        <!-- Retract Dialog -->
        <div v-if="showRetractModal" class="modal-overlay" @click="closeRetractDialog">
            <div class="modal" @click.stop>
                <h3>{{ t('dialogs.retractTitle', { slot: retractSlot }) }}</h3>
                <div class="form-group">
                    <label>{{ t('dialogs.length') }}</label>
                    <input type="number" v-model.number="retractLength" min="1" max="2000">
                </div>
                <div class="form-group">
                    <label>{{ t('dialogs.speed') }}</label>
                    <input type="number" v-model.number="retractSpeed" min="1" max="100">
                </div>
                <div class="modal-actions">
                    <button @click="executeRetract" class="btn btn-primary">{{ t('dialogs.execute') }}</button>
                    <button @click="closeRetractDialog" class="btn btn-secondary">{{ t('dialogs.cancel') }}</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div v-if="notification.show" class="toast" :class="notification.type">
            {{ notification.message }}
        </div>
    </div>

    <script src="ace-dashboard.js"></script>
</body>
</html>

